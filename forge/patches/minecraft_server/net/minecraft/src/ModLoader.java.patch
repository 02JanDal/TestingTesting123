--- ../src_base/minecraft_server/net/minecraft/src/ModLoader.java	0000-00-00 00:00:00.000000000 -0000
+++ ../src_work/minecraft_server/net/minecraft/src/ModLoader.java	0000-00-00 00:00:00.000000000 -0000
@@ -27,6 +27,9 @@
 import java.util.zip.ZipEntry;
 import java.util.zip.ZipInputStream;
 import net.minecraft.server.MinecraftServer;
+import net.minecraft.src.forge.DimensionManager;
+import net.minecraft.src.forge.ForgeHooks;
+import net.minecraft.src.forge.NetworkMod;
 
 public final class ModLoader
 {
@@ -675,6 +678,17 @@
             readFromModFolder(modDir);
             readFromClassPath(var17);
             System.out.println("Done.");
+            /*
+             * Gather up a list of network mods and assign them an id 
+             */
+            int x = 0;
+            for (BaseMod mod : (List<BaseMod>)modList)
+            {
+                if (mod instanceof NetworkMod)
+                {
+                    ForgeHooks.networkMods.put(x++, (NetworkMod)mod);
+                }
+            }
             props.setProperty("loggingLevel", cfgLoggingLevel.getName());
             Iterator var19 = modList.iterator();
 
@@ -838,9 +852,10 @@
 
         long var1 = 0L;
 
-        if (var0.worldMngr != null && var0.worldMngr[0] != null)
+        WorldServer world = (WorldServer)DimensionManager.getWorld(0);
+        if (world != null)
         {
-            var1 = var0.worldMngr[0].getWorldTime();
+            var1 = world.getWorldTime();
             Iterator var3 = inGameHooks.entrySet().iterator();
 
             while (var3.hasNext())
@@ -1385,6 +1400,7 @@
             {
                 method_getNextWindowId.invoke(var4, new Object[0]);
                 int var5 = field_currentWindowId.getInt(var4);
+                var4.closeCraftingGui();
                 var4.playerNetServerHandler.sendPacket(new Packet100OpenWindow(var5, var1, var2.getInvName(), var2.getSizeInventory()));
                 var4.craftingInventory = var3;
                 var4.craftingInventory.windowId = var5;
